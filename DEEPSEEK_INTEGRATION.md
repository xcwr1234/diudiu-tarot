# DeepSeek API 塔罗牌解读集成

## 概述

本项目已成功集成 DeepSeek API 来提供智能的塔罗牌解读功能。DeepSeek 作为专业的 AI 模型，能够提供深入、准确且富有启发性的塔罗牌解读。

## 功能特性

### 🤖 AI 智能解读
- 基于 DeepSeek 大语言模型的智能解读
- 支持中文自然语言处理
- 提供个性化的占卜建议
- 包含牌与牌之间的关联分析

### 🎴 专业塔罗牌知识
- 精通四种塔罗牌体系（马赛、黄金黎明、维特、头特）
- 准确理解正位/逆位含义
- 深入分析牌面位置意义
- 提供整体能量和主题分析

### 📝 详细解读内容
1. **位置解释** - 每张牌在特定位置的意义
2. **关联分析** - 牌与牌之间的相互影响
3. **能量分析** - 整体能量和主题
4. **具体建议** - 针对问题的指导
5. **发展趋势** - 可能的发展方向

## 技术实现

### API 集成

```typescript
// DeepSeek 客户端配置
const deepseekClient = new OpenAI({
  apiKey: process.env.DEEPSEEK_API_KEY,
  baseURL: "https://api.deepseek.com/v1",
});

// 生成解读
const response = await deepseekClient.chat.completions.create({
  model: "deepseek-chat",
  messages: [
    {
      role: "system",
      content: "你是一位专业的塔罗牌占卜师..."
    },
    {
      role: "user", 
      content: prompt
    }
  ],
  temperature: 0.7,
  max_tokens: 2000,
});
```

### 提示词工程

系统设计了专业的提示词模板，包含：

- **角色设定** - 专业塔罗牌占卜师
- **上下文信息** - 用户问题、牌组类型、占卜方式
- **牌面数据** - 每张牌的详细信息
- **解读要求** - 具体的分析维度

### 错误处理

- API 调用失败时自动回退到基础解读
- 网络错误和超时处理
- 用户友好的错误提示

## 环境配置

### 1. 获取 DeepSeek API Key

1. 访问 [DeepSeek 官网](https://platform.deepseek.com/)
2. 注册账号并登录
3. 在控制台获取 API Key

### 2. 配置环境变量

创建 `.env.local` 文件并添加：

```bash
# DeepSeek API for Tarot Interpretation
DEEPSEEK_API_KEY="sk-your-deepseek-api-key-here"
```

### 3. 验证配置

启动开发服务器并测试功能：

```bash
npm run dev
```

访问 `/tarot` 页面进行测试。

## API 端点

### POST /api/tarot/deepseek

用于生成 AI 解读的专用端点。

**请求参数：**
```json
{
  "question": "用户的问题",
  "cards": [
    {
      "card_name": "牌名",
      "is_reversed": false,
      "upright_meaning": "正位含义",
      "reversed_meaning": "逆位含义",
      "arcana_type": "major",
      "suit": null
    }
  ],
  "deck_type": "waite",
  "spread_type": "three_card"
}
```

**响应格式：**
```json
{
  "code": 0,
  "data": {
    "interpretation": "AI 生成的详细解读内容"
  }
}
```

## 使用流程

### 1. 基础占卜
1. 选择牌组类型（马赛、黄金黎明、维特、头特）
2. 选择占卜方式（单张、三张、凯尔特十字、马蹄形）
3. 输入你的问题
4. 点击"开始占卜"
5. 逐步揭示卡片

### 2. AI 深度解读
1. 完成基础占卜后
2. 点击"AI深度解读"按钮
3. 等待 AI 生成详细解读
4. 查看专业的分析结果

## 解读示例

### 输入问题
"我的事业发展如何？"

### AI 解读输出
```
🌟 基于你的问题"我的事业发展如何？"，我来为你详细解读这次塔罗牌占卜。

📋 占卜信息
- 使用：维特塔罗牌组
- 占卜方式：三张牌占卜
- 抽到的牌：过去-愚者(正位)、现在-魔术师(正位)、未来-星星(正位)

🔍 详细解读

【过去-愚者(正位)】
愚者代表你事业起步时的纯真和勇气。你带着对未来的美好憧憬开始了职业道路，虽然经验不足，但充满创新精神和冒险精神。这个阶段奠定了你事业发展的基础。

【现在-魔术师(正位)】
魔术师显示你目前正处于事业的关键期，拥有实现目标所需的所有资源和技能。你正在运用自己的才能和创造力，将想法转化为实际行动。这是一个充满潜力和机会的阶段。

【未来-星星(正位)】
星星预示着你的职业前景光明，将获得精神上的满足和成就感。你的努力会得到回报，事业将朝着积极的方向发展。保持希望和信心，美好的结果正在等待着你。

💫 整体分析
这三张牌都处于正位，形成了一个非常积极的能量流。从愚者的纯真开始，经过魔术师的技能运用，最终达到星星的希望和成就。这表明你的事业发展轨迹是向上的，充满了正能量。

🎯 建议指导
1. 保持初心：像愚者一样保持对事业的热爱和好奇心
2. 善用技能：像魔术师一样充分发挥自己的才能
3. 保持希望：像星星一样对未来充满信心
4. 持续学习：不断提升自己的专业能力

🚀 发展趋势
你的职业道路将呈现稳步上升的趋势，有望在不久的将来取得重要的职业成就。建议继续保持当前的积极态度和工作热情。

记住，塔罗牌是指导而非决定，你的选择和行动才是决定未来的关键因素。
```

## 优势特点

### 🎯 专业性
- 基于深厚的塔罗牌理论知识
- 准确理解各种牌组的特点
- 专业的占卜师角色设定

### 🤖 智能化
- 自然语言处理能力
- 上下文理解能力
- 个性化解读生成

### 🌍 本地化
- 完全中文界面
- 符合中文用户习惯
- 文化适应性解读

### 🔄 可靠性
- 多重错误处理机制
- 自动回退功能
- 稳定的 API 调用

## 注意事项

1. **API 限制** - 注意 DeepSeek API 的调用频率限制
2. **成本控制** - 监控 API 使用量，避免过度调用
3. **隐私保护** - 用户问题数据的安全处理
4. **内容审核** - 确保生成内容符合平台规范

## 故障排除

### 常见问题

1. **API Key 错误**
   - 检查环境变量配置
   - 验证 API Key 有效性

2. **网络连接问题**
   - 检查网络连接
   - 验证 API 端点可访问性

3. **解读生成失败**
   - 检查请求参数格式
   - 查看服务器日志

### 调试方法

```bash
# 检查环境变量
echo $DEEPSEEK_API_KEY

# 测试 API 连接
curl -X POST https://api.deepseek.com/v1/chat/completions \
  -H "Authorization: Bearer $DEEPSEEK_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-chat","messages":[{"role":"user","content":"test"}]}'
```

## 未来扩展

1. **多语言支持** - 支持英文等其他语言
2. **个性化解读** - 基于用户历史记录定制解读
3. **图像生成** - 集成图像生成功能
4. **语音解读** - 添加语音播报功能
5. **社区功能** - 用户分享和讨论功能

## 许可证

本项目遵循 ShipAny AI SaaS 启动模板许可证协议。 